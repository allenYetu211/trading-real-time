# Telegram 交互式 Bot 使用指南

## 🤖 简介

本交易系统现已支持 Telegram Bot 交互式功能，提供两种操作方式：传统命令和智能交互。您可以直接在 Telegram 聊天中使用简化命令来管理4个周期的监控配置和获取多周期综合分析。

✨ **全新交互式体验**：无需记忆复杂命令，支持逐步引导和可视化选择操作！

## 🚀 快速开始

### 1. 配置 Telegram Bot

确保在 `.env` 文件中配置了以下变量：

```bash
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here
TELEGRAM_ENABLED=true
```

### 2. 启动系统

```bash
pnpm start:dev
```

### 3. 开始使用

在 Telegram 中向 Bot 发送 `/help` 命令查看所有可用功能。

## 📋 命令列表

### 基础命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/help` | 显示帮助信息 | `/help` |
| `/start` | 欢迎消息和简介 | `/start` |
| `/menu` | 显示快捷操作菜单 | `/menu` |

### 监控管理

| 命令 | 说明 | 示例 |
|------|------|------|
| `/list` | 查看当前监控的交易对 | `/list` |
| `/add [交易对]` | 添加全周期监控交易对 | `/add BTCUSDT` 或 `/add` |
| `/remove [交易对]` | 删除全周期监控交易对 | `/remove ETHUSDT` 或 `/remove` |

### 实时分析

| 命令 | 说明 | 示例 |
|------|------|------|
| `/analyze [交易对]` | 立即分析指定交易对(全周期) | `/analyze SOLUSDT` 或 `/analyze` |

## ✨ 交互式功能

### 智能添加监控

**方式一：传统命令**
```
/add BTCUSDT
```

**方式二：交互式操作**
```
1. 发送 /add
2. 等待提示消息
3. 输入交易对名称（如：BTCUSDT）
4. 系统自动添加全周期监控
```

### 可视化删除监控

**方式一：传统命令**
```
/remove ETHUSDT
```

**方式二：交互式选择**
```
1. 发送 /remove
2. 查看当前监控列表按钮
3. 点击要删除的交易对按钮
4. 确认删除结果
```

### 快速分析选择

**方式一：传统命令**
```
/analyze SOLUSDT
```

**方式二：交互式选择**
```
1. 发送 /analyze
2. 查看当前监控列表按钮
3. 点击要分析的交易对按钮
4. 等待全周期分析结果
```

## 🎯 使用场景

### 新手用户
- 使用交互式命令：`/add` → 输入交易对
- 使用可视化选择：`/remove` → 点击按钮
- 逐步引导，降低学习成本

### 熟练用户
- 直接使用完整命令：`/add BTCUSDT`
- 快速操作，提高效率

### 移动设备用户
- 点击按钮比输入命令更便捷
- 减少输入错误

## 🧪 测试功能

### 实时分析

| 命令 | 说明 | 示例 |
|------|------|------|
| `/analyze <交易对>` | 立即分析指定交易对(全周期) | `/analyze SOLUSDT` |

## ⏱️ 自动监控的时间周期

系统固定监控以下4个时间周期：
- `5m` - 5分钟
- `15m` - 15分钟  
- `1h` - 1小时
- `4h` - 4小时

🎯 **特色**: 一个命令操作所有4个周期，获得全面的技术分析视角

## 📱 菜单系统

### 命令菜单
- 点击输入框旁边的 "菜单" 按钮
- 或输入 "/" 查看所有可用命令
- 自动显示命令描述和使用方法

### 快捷操作面板
- 使用 `/menu` 命令打开内联键盘面板
- 动态显示监控的交易对按钮
- 一键执行操作，无需记忆命令

### 菜单功能
- 📊 **查看监控** - 快速显示当前监控列表
- ➕ **添加监控** - 引导式添加新的交易对监控
- ❌ **删除监控** - 选择性删除监控配置
- 🔍 **快速分析** - 直接分析指定交易对的全周期数据
- 📈 **交易对按钮** - 为每个监控的交易对生成快速分析按钮

## 💡 使用示例

### 添加监控

```
/add BTCUSDT        # 添加 BTC 全周期监控 (5m/15m/1h/4h)
/add ETHUSDT        # 添加 ETH 全周期监控
/add SOLUSDT        # 添加 SOL 全周期监控
```

### 删除监控

```
/remove BTCUSDT     # 删除 BTC 全周期监控
/remove ETHUSDT     # 删除 ETH 全周期监控
```

### 立即分析

```
/analyze BTCUSDT    # 立即分析 BTC 全周期 (5m/15m/1h/4h)
/analyze ETHUSDT    # 立即分析 ETH 全周期并生成综合报告
```

### 查看监控列表

```
/list               # 显示所有监控配置
```

## 🔔 自动通知

系统会继续按照定时任务自动分析监控的交易对的所有4个周期，并将多周期综合分析结果自动发送到 Telegram。您不需要手动请求，只有想要立即获取某个交易对的全周期分析结果时才需要使用 `/analyze` 命令。

🎯 **多周期分析特色**:
- 自动计算各周期的综合信号
- 智能检测信号一致性
- 提供市场结构分析
- 生成交易建议

## 🧪 测试功能

运行测试脚本来验证命令功能：

```bash
# 测试基础 Telegram 功能
pnpm test:telegram

# 测试命令功能
pnpm test:telegram-commands

# 测试菜单功能
pnpm test:telegram-menu

# 测试交互式功能 (新功能)
pnpm test:telegram-interactive
```

### 交互式功能测试步骤

运行交互式测试脚本后，按照以下步骤测试：

1. **测试智能添加**
   - 发送 `/add`
   - 输入 `LINKUSDT`
   - 验证添加结果

2. **测试可视化删除**
   - 发送 `/remove`
   - 点击删除按钮
   - 确认删除结果

3. **测试快速分析**
   - 发送 `/analyze`
   - 点击分析按钮
   - 等待分析结果

4. **测试状态管理**
   - 发送 `/add`
   - 发送任意其他命令
   - 验证状态被清除

5. **测试输入验证**
   - 发送 `/add`
   - 输入无效交易对
   - 验证错误提示

## 🛠️ 故障排除

### 常见问题

1. **Bot 不响应命令**
   - 检查 `TELEGRAM_BOT_TOKEN` 是否正确
   - 确认 Bot 已启用轮询模式
   - 检查服务器日志是否有错误

2. **收到"未授权聊天"警告**
   - 检查 `TELEGRAM_CHAT_ID` 是否正确
   - 确保已向 Bot 发送过消息

3. **命令执行失败**
   - 检查交易对名称是否正确（如 BTCUSDT）
   - 确认交易对是否在市场上存在和交易
   - 查看服务器日志获取详细错误信息

### 调试步骤

1. 检查环境变量配置
2. 查看服务器启动日志
3. 测试 Bot 连接：`/start` 命令
4. 运行测试脚本验证功能

## 🔐 安全注意事项

- 保护好您的 Bot Token，不要在代码中硬编码
- 只在配置的 Chat ID 中使用命令
- 定期检查 Bot 活动日志
- 考虑使用环境变量加密存储敏感信息

## 📱 移动端使用

本功能完全支持 Telegram 移动端应用，您可以在手机上随时使用命令管理交易监控和获取分析结果。

## 🆕 后续功能

计划中的功能增强：

- [ ] 订阅特定信号类型
- [ ] 自定义通知频率
- [ ] 历史分析查询
- [ ] 批量操作命令
- [ ] 图表生成和发送

---

💡 **提示**: 如果您在使用过程中遇到任何问题，请查看服务器日志或联系系统管理员。 
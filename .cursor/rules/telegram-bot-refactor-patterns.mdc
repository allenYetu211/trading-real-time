# Telegram Boté‡æ„æ¨¡å¼å’Œæ¶æ„è§„èŒƒ

## ğŸ“ ç›®å½•ç»“æ„è§„èŒƒ

å½“ä¿®æ”¹æˆ–æ‰©å±•Telegram BotåŠŸèƒ½æ—¶ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
src/modules/telegram-ccxt-analysis/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ telegram-ccxt-analysis.service.ts     # ä¸»æœåŠ¡ (ç²¾ç®€ç‰ˆ)
â”œâ”€â”€ utils/                                     # å·¥å…·åŒ… (æ ¸å¿ƒ)
â”‚   â”œâ”€â”€ interfaces/                            # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ emoji/                                 # è¡¨æƒ…ç¬¦å·å·¥å…·
â”‚   â”œâ”€â”€ formatters/                            # æ¶ˆæ¯æ ¼å¼åŒ–å™¨
â”‚   â”œâ”€â”€ templates/                             # èœå•æ¨¡æ¿
â”‚   â”œâ”€â”€ bot/                                   # Botç®¡ç†å·¥å…·
â”‚   â”œâ”€â”€ analysis/                              # åˆ†æå¤„ç†å™¨
â”‚   â”œâ”€â”€ commands/                              # å‘½ä»¤å¤„ç†å™¨ (å¯æ‰©å±•)
â”‚   â”œâ”€â”€ index.ts                               # ç»Ÿä¸€å¯¼å‡º
â”‚   â””â”€â”€ README.md                              # ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ controller, moduleç­‰å…¶ä»–æ–‡ä»¶
```

## ğŸ”§ æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™
- æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- å·¥å…·ç±»ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œä¾¿äºç›´æ¥è°ƒç”¨
- æ ¼å¼åŒ–å™¨ä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨åˆ†ç¦»

### 2. ä¾èµ–æ³¨å…¥è§„èŒƒ
```typescript
// âœ… æ­£ç¡®ï¼šé€šè¿‡å‚æ•°ä¼ å…¥ä¾èµ–
static async performAnalysis(
  coreTechnicalAnalysisService: CoreTechnicalAnalysisService,
  symbol: string
): Promise<string> { ... }

// âŒ é”™è¯¯ï¼šåœ¨å·¥å…·ç±»ä¸­æ³¨å…¥ä¾èµ–
@Injectable()
class SomeUtil { ... }
```

### 3. å¯¼å…¥å¯¼å‡ºè§„èŒƒ
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»Ÿä¸€çš„å·¥å…·åŒ…å¯¼å…¥
import {
  BotManagerUtil,
  AnalysisProcessorUtil,
  ComprehensiveAnalysisFormatter,
  MenuTemplate,
  EmojiUtil
} from '../utils';

// âŒ é”™è¯¯ï¼šç›´æ¥å¯¼å…¥å…·ä½“æ–‡ä»¶
import { BotManagerUtil } from '../utils/bot/bot-manager.util';
```

## ğŸ“ ä»£ç ç»„ç»‡è§„èŒƒ

### 1. æ¥å£å®šä¹‰
æ‰€æœ‰æ¥å£å¿…é¡»åœ¨ `utils/interfaces/` ä¸­å®šä¹‰ï¼š
```typescript
// utils/interfaces/telegram.interface.ts
export interface TelegramConfig { ... }
export interface UserState { ... }
export enum AnalysisType { ... }
```

### 2. æ ¼å¼åŒ–å™¨è§„èŒƒ
æ¯ç§åˆ†æç±»å‹å¿…é¡»æœ‰å¯¹åº”çš„æ ¼å¼åŒ–å™¨ï¼š
```typescript
// utils/formatters/[analysis-type].formatter.ts
export class [AnalysisType]Formatter {
  static formatMessage(symbol: string, analysis: any): string {
    // æ ¼å¼åŒ–é€»è¾‘
  }
}
```

### 3. æ¨¡æ¿ç®¡ç†
æ‰€æœ‰èœå•æ¨¡æ¿é›†ä¸­ç®¡ç†ï¼š
```typescript
// utils/templates/menu.template.ts
export class MenuTemplate {
  static getMainMenu(): string { ... }
  static getAnalysisTypeMenu(): any { ... }
  static getSymbolSelectionMenu(type: AnalysisType): any { ... }
}
```

## ğŸš€ æ‰©å±•æ–°åŠŸèƒ½è§„èŒƒ

### æ·»åŠ æ–°åˆ†æç±»å‹çš„æ­¥éª¤ï¼š

1. **æ›´æ–°æšä¸¾å®šä¹‰**
```typescript
// utils/interfaces/telegram.interface.ts
export enum AnalysisType {
  COMPREHENSIVE = 'comprehensive',
  TREND = 'trend',
  SUPPORT_RESISTANCE = 'support_resistance',
  NEW_ANALYSIS = 'new_analysis'  // æ–°å¢
}
```

2. **åˆ›å»ºæ ¼å¼åŒ–å™¨**
```typescript
// utils/formatters/new-analysis.formatter.ts
export class NewAnalysisFormatter {
  static formatMessage(symbol: string, analysis: any): string {
    return `æ–°åˆ†æç»“æœï¼š${symbol}...`;
  }
}
```

3. **æ›´æ–°åˆ†æå¤„ç†å™¨**
```typescript
// utils/analysis/analysis-processor.util.ts
static async performNewAnalysis(
  coreTechnicalAnalysisService: CoreTechnicalAnalysisService,
  symbol: string
): Promise<string> {
  // åˆ†æé€»è¾‘
}
```

4. **æ›´æ–°èœå•æ¨¡æ¿**
```typescript
// utils/templates/menu.template.ts
static getAnalysisTypeMenu(): any {
  return {
    reply_markup: {
      inline_keyboard: [
        // ç°æœ‰é€‰é¡¹...
        [{ text: 'ğŸ†• æ–°åˆ†æ', callback_data: 'symbols_list:new_analysis' }]
      ]
    }
  };
}
```

## ğŸ” ä»£ç è´¨é‡è¦æ±‚

### 1. ç±»å‹å®‰å…¨
- æ‰€æœ‰æ–¹æ³•å¿…é¡»æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰
- é¿å…ä½¿ç”¨ `any` ç±»å‹ï¼Œä¼˜å…ˆä½¿ç”¨å…·ä½“æ¥å£
- ä½¿ç”¨æšä¸¾æ›¿ä»£å­—ç¬¦ä¸²å¸¸é‡

### 2. é”™è¯¯å¤„ç†
```typescript
// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼
try {
  const result = await someOperation();
  return result;
} catch (error) {
  this.logger.error(`æ“ä½œå¤±è´¥ ${symbol}:`, error);
  throw new Error(`æ“ä½œå¤±è´¥: ${error.message}`);
}
```

### 3. æ—¥å¿—è®°å½•
```typescript
// âœ… æ­£ç¡®ï¼šå…³é”®æ“ä½œå¿…é¡»è®°å½•æ—¥å¿—
static async performAnalysis(...): Promise<string> {
  this.logger.log(`å¼€å§‹æ‰§è¡Œ ${symbol} åˆ†æ`);
  // ä¸šåŠ¡é€»è¾‘
  this.logger.log(`${symbol} åˆ†æå®Œæˆ`);
  return result;
}
```

## ğŸ“š æ–‡æ¡£è¦æ±‚

### 1. æ¯ä¸ªå·¥å…·ç±»å¿…é¡»æœ‰è¯¦ç»†æ³¨é‡Š
```typescript
/**
 * åˆ†æå¤„ç†å™¨å·¥å…·ç±»
 * è´Ÿè´£æ‰§è¡Œå„ç§æŠ€æœ¯åˆ†æå¹¶æ ¼å¼åŒ–ç»“æœ
 */
export class AnalysisProcessorUtil {
  /**
   * æ‰§è¡Œå®Œæ•´æŠ€æœ¯åˆ†æ
   * @param coreTechnicalAnalysisService æ ¸å¿ƒæŠ€æœ¯åˆ†ææœåŠ¡
   * @param symbol äº¤æ˜“å¯¹ç¬¦å·
   * @returns æ ¼å¼åŒ–çš„åˆ†ææ¶ˆæ¯
   */
  static async performComprehensiveAnalysis(...): Promise<string> { ... }
}
```

### 2. READMEæ–‡æ¡£å¿…é¡»ä¿æŒæœ€æ–°
- æ·»åŠ æ–°åŠŸèƒ½æ—¶å¿…é¡»æ›´æ–° `utils/README.md`
- åŒ…å«ä½¿ç”¨ç¤ºä¾‹å’ŒAPIè¯´æ˜
- è®°å½•ä¾èµ–å…³ç³»å’Œæ‰©å±•æ–¹æ³•

## âš ï¸ ç¦æ­¢äº‹é¡¹

1. **ä¸è¦åœ¨å·¥å…·ç±»ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥** - ä¿æŒå·¥å…·ç±»çš„çº¯å‡€æ€§
2. **ä¸è¦æ··åˆä¸šåŠ¡é€»è¾‘å’Œæ ¼å¼åŒ–é€»è¾‘** - ä¸¥æ ¼åˆ†ç¦»å…³æ³¨ç‚¹
3. **ä¸è¦ç¡¬ç¼–ç é…ç½®å’Œå¸¸é‡** - ä½¿ç”¨é…ç½®æ–‡ä»¶å’Œæšä¸¾
4. **ä¸è¦åˆ›å»ºè¶…è¿‡400è¡Œçš„æ–‡ä»¶** - åŠæ—¶æ‹†åˆ†å¤§æ–‡ä»¶
5. **ä¸è¦ç ´åç°æœ‰APIæ¥å£** - ä¿æŒå‘åå…¼å®¹æ€§

## ğŸ”„ é‡æ„æ£€æŸ¥æ¸…å•

åœ¨ä¿®æ”¹Telegram Botç›¸å…³ä»£ç æ—¶ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æ˜¯å¦éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ç›®å½•ç»“æ„ï¼Ÿ
- [ ] æ˜¯å¦æœ‰é€‚å½“çš„ç±»å‹å®šä¹‰ï¼Ÿ
- [ ] æ˜¯å¦åŒ…å«é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº†ç›¸å…³æ–‡æ¡£ï¼Ÿ
- [ ] æ˜¯å¦ä¿æŒäº†APIçš„å‘åå…¼å®¹æ€§ï¼Ÿ
- [ ] æ˜¯å¦æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•ï¼Ÿ

å‚è€ƒé‡æ„ç¤ºä¾‹ï¼š[telegram-ccxt-analysis.service.ts](mdc:src/modules/telegram-ccxt-analysis/services/telegram-ccxt-analysis.service.ts) å’Œ [utilsç›®å½•](mdc:src/modules/telegram-ccxt-analysis/utils)
description:
globs:
alwaysApply: false
---

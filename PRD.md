# 📄 产品需求文档（PRD）

## 项目名称：多币种图像结构识别与辅助交易策略系统

---

## 一、项目背景与目标

为了更高效地参与币圈交易，交易者希望借助结构化分析模型对多个代币进行 K 线结构识别与策略判断，辅助人工交易操作。  
本系统通过 Binance API 实时拉取数据，识别典型图像结构（如箱体震荡、上破、下破等），根据配置的策略输出清晰的“买/卖/观望”建议，**不自动下单，仅辅助人工决策**。

---

## 二、核心功能模块

### 1. 币种监控配置

- 支持添加/删除监控币种（例如：BTCUSDT、ETHUSDT）
- 配置每个币种的分析周期（如：1m、15m、1h、4h、1d）

### 2. K 线数据获取模块

- 实时数据：使用 Binance WebSocket 实时订阅
- 历史数据：使用 REST API 补齐分析窗口历史数据
- 数据缓存：保存最近 N 条数据用于分析
- 异常机制：自动重连、错误重试等容错机制

### 3. 图像结构识别模块

识别下列常见图形结构：

| 结构类型   | 识别条件说明                                             |
|------------|----------------------------------------------------------|
| 箱体结构   | 高点/低点波动收敛在一定区间，近 N 根蜡烛最高/最低差值小于 X% |
| 突破上涨   | 当前价格突破箱体上轨，且成交量较近 N 根均值上涨 Y%         |
| 突破下跌   | 当前价格跌破箱体下轨，伴随放量或趋势指标背离              |

### 4. 策略判断与决策输出模块

支持以下策略：

#### ✅ 策略一：箱体高抛低吸策略

- 买入信号：接近箱体下轨，波动缩小  
- 卖出信号：价格达到箱体上轨  

#### ✅ 策略二：趋势突破追涨/止跌策略

- 买入信号：突破上轨 + 成交量增加  
- 卖出信号：跌破下轨 + 成交量增加  

#### ✅ 策略三：MACD 辅助背离判断

- 买入信号：金叉 + 价格回调不破低  
- 卖出信号：死叉 + 价格创新低  

#### 输出格式示例（JSON）：

```json
{
  "symbol": "BTCUSDT",
  "interval": "1h",
  "detected_pattern": "箱体 → 准备突破",
  "recommendation": "等待突破上轨后放量介入",
  "key_levels": {
    "upper": 58000,
    "lower": 56000
  },
  "confidence": 0.76,
  "note": "MACD 金叉确认中"
}
```


### 三、算法模块架构（技术实现框架）

+------------------------------+
|    Web 控制台 或 CLI 入口     |
+------------------------------+
              │
+-------------▼----------------+
|       策略调度器 & 管理器      |
+-------------┬----------------+
              │
+-------------▼----------------+
|     图像结构识别模块（核心）   |
|  └── 箱体识别器               |
|  └── 突破识别器               |
|  └── MACD/EMA 模型            |
+-------------┬----------------+
              │
+-------------▼----------------+
|   实时与历史数据拉取模块      |
|  └── Binance API 连接层       |
|  └── 数据缓存 与 预处理层     |
+-------------┬----------------+
              │
+-------------▼----------------+
|     决策输出模块（人工辅助）   |
|  └── 控制台 输出              |
|  └── 文件保存（CSV/JSON）     |
|  └── Telegram / Email 通知    |
+------------------------------+



### 四、Binance API 接口说明
1. 获取历史 K 线数据（REST 接口）
请求方式：
GET https://api.binance.com/api/v3/klines
示例参数：
```
symbol=BTCUSDT
interval=1h
limit=100
```

- https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=100
响应字段示例：

```json

[
  [
    1616668800000,
    "55000.00",
    "55200.00",
    "54500.00",
    "54750.00",
    "120.123"
  ]
]
```


2. 实时 K 线订阅（WebSocket）
订阅地址模板：
- wss://stream.binance.com:9443/ws/{symbol_lower}@kline_{interval}
示例：

- wss://stream.binance.com:9443/ws/btcusdt@kline_1h
示例消息结构：

```json
{
  "e": "kline",
  "E": 1616668860000,
  "s": "BTCUSDT",
  "k": {
    "t": 1616668800000,
    "T": 1616668859999,
    "s": "BTCUSDT",
    "i": "1h",
    "f": 177038123,
    "L": 177038456,
    "o": "55000.00",
    "c": "55100.00",
    "h": "55200.00",
    "l": "54900.00",
    "v": "50.123",
    "n": 1234,
    "x": false,
    "q": "2760000.00"
  }
}
```

### 五、输出示例（人工辅助）
```json
{
  "symbol": "ETHUSDT",
  "interval": "15m",
  "detected_pattern": "箱体结构",
  "recommendation": "等待箱体突破或回调买入",
  "key_levels": {
    "upper": 3290,
    "lower": 3210
  },
  "confidence": 0.84,
  "note": "MACD 金叉确认中"
}
```

### 六、注意事项
所有输出仅为辅助提示，交易决策需由人工执行

Binance API 存在频率限制，建议结合缓存与限流策略

结构识别阈值需根据回测和实盘结果不断调优

### 七、未来扩展方向（可选）
集成交互式图形化界面以展示结构与信号

策略回测与可视化分析模块

用户可自定义策略参数与结构模型

支持其他交易所（例如：OKX、Huobi）API